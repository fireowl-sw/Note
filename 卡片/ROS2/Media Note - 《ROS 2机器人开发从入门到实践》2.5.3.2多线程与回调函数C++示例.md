---
media: https://www.bilibili.com/video/BV18mWjeEEXS
---
![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 00:00](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT0.333S.webp) [00:00](https://www.bilibili.com/video/BV18mWjeEEXS?t=0.333#t=0.33) 

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 00:24](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT24.76S.webp) [00:24](https://www.bilibili.com/video/BV18mWjeEEXS?t=24.759584#t=24.76) 下载C++http请求库

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 01:48](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT1M48.861S.webp) [01:48](https://www.bilibili.com/video/BV18mWjeEEXS?t=108.86074#t=01:48.86) 修改CMakeList文件

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 03:31](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT3M31.531S.webp) [03:31](https://www.bilibili.com/video/BV18mWjeEEXS?t=211.531018#t=03:31.53) 导库

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 05:13](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT5M13.341S.webp) [05:13](https://www.bilibili.com/video/BV18mWjeEEXS?t=313.341281#t=05:13.34) 定义类

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 05:50](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT5M50.838S.webp) [05:50](https://www.bilibili.com/video/BV18mWjeEEXS?t=350.837655#t=05:50.84) 写两个函数
download函数
启动下载函数(创建线程)

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 08:44](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT8M44.049S.webp) [08:44](https://www.bilibili.com/video/BV18mWjeEEXS?t=524.049344#t=08:44.05) 创建回调函数

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 10:43](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT10M43.574S.webp) [10:43](https://www.bilibili.com/video/BV18mWjeEEXS?t=643.573684#t=10:43.57) 调用

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 12:03](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT12M3.258S.webp) [12:03](https://www.bilibili.com/video/BV18mWjeEEXS?t=723.258337#t=12:03.26) 设置当前主线程休眠
避免return 0 杀死所有线程


![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 13:06](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT13M6.3S.webp) [13:06](https://www.bilibili.com/video/BV18mWjeEEXS?t=786.300381#t=13:06.30) 完善download函数
- 打印线程编号
- 创建客户端
- 获取请求结果
- 判断是否响应(200表示成功响应)
- 调用回调函数处理下载内容
- 
![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 16:23](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT16M23.379S.webp) [16:23](https://www.bilibili.com/video/BV18mWjeEEXS?t=983.379144#t=16:23.38) start函数
- 创建线程(包装download成员函数后传入)
- 包装 std::bind(&对象地址，对象指针，函数参数们的占位符)
- C++线程创建好后会立马运行会堵塞当前线程
- thread.detach();把它们从当前线程中分离出来让程序运行下去
![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 19:55](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT19M55.045S.webp) [19:55](https://www.bilibili.com/video/BV18mWjeEEXS?t=1195.045087#t=19:55.05) 添加到CMakeList

![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 20:21](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT20M21.949S.webp) [20:21](https://www.bilibili.com/video/BV18mWjeEEXS?t=1221.948968#t=20:21.95) 运行
- 开启python的服务器
- 使用c++的客户端下载
![《ROS 2机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例 - 21:13](《ROS%202机器人开发从入门到实践》2.5.3.2多线程与回调函数C++示例PT21M13.205S.webp) [21:13](https://www.bilibili.com/video/BV18mWjeEEXS?t=1273.204861#t=21:13.20) 没打印出来的问题
- 截取的字符不够 汉字3个字节一个字utf-8
- 下载顺序和打印顺序不一样